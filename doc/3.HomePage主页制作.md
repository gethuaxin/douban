## Home 主页制作

### 1、基本框架

添加 lib\model\subject.dart


```
class Subject{
  
}
```

添加 lib/widgets/search_text_field_widget.dart

```
import 'package:flutter/material.dart';

class SearchTextFieldWidget extends StatelessWidget{
  @override
  Widget build(BuildContext context) {
    
    return Center(
      child: Text('搜索栏'),
    );
  }
  
}
```

修改 lib\home\home\home_page.dart

```
import '../../widgets/search_text_field_widget.dart';
import 'package:flutter/material.dart';
import '../model/subject.dart';
class HomePage extends StatelessWidget{
  @override
  Widget build(BuildContext context) {
    print('build HomePage');
    return getWidget();
  }
}
var _tabs = ['动态', '推荐'];
// 返回默认的Tab控制器
DefaultTabController getWidget() {
  return DefaultTabController(
    initialIndex: 1,
    length: _tabs.length,
    child: NestedScrollView(
      headerSliverBuilder: (BuildContext context, bool innerBoxIsScrolled){
        return <Widget>[
          SliverOverlapAbsorber(
            handle: NestedScrollView.sliverOverlapAbsorberHandleFor(context),
            // SliverAppBar 待完善
            child: SliverAppBar(
                pinned: true,
                expandedHeight: 120.0,
                primary: true,
                titleSpacing: 0.0,
                backgroundColor: Colors.white,
                flexibleSpace: FlexibleSpaceBar(  
                collapseMode: CollapseMode.pin,
                  background: Container(
                    color: Colors.green,
                    child: SearchTextFieldWidget(),
                    alignment: Alignment(0.0, 0.0),
                  ),
                ),
                bottom: TabBar(
                  isScrollable: true,
                  tabs: _tabs
                    .map((String name) => Container(
                          child: Text(
                            name,
                          ),
                          padding: const EdgeInsets.only(bottom: 5.0),
                        ))
                    .toList(),
                )
            )
          )
        ];
      },
      body: TabBarView(
        // tab下的内容
        children: _tabs.map((String name) {
          return SliverContainer(
            name: name,
          );
        }).toList(),
      )
    ),
  );
}
class SliverContainer extends StatefulWidget{
  final String name;
  SliverContainer({Key key, @required this.name}) : super(key:key);
  @override
  _SliverContainerState createState() => _SliverContainerState();
}

class _SliverContainerState extends State<SliverContainer>{

  @override
  void initState() {
    super.initState();
    print('init state${widget.name}');
    ///请求动态数据
    if (list == null || list.isEmpty) {
      if (_tabs[0] == widget.name) {
        requestAPI();
      } else {
        ///请求推荐数据
        requestAPI();
      }
    }
  }

  // 添加 subject
  List<Subject> list;

  void requestAPI() {
    print("请求动态数据");
  }

  @override
  Widget build(BuildContext context) {
    
    return getContentSliver(context, list);
  }
  getContentSliver(BuildContext context, List<Subject> list) {
    if (widget.name == _tabs[0]) {
      return _loginContainer(context);
    }

    print('getContentSliver');

    if (list == null || list.length == 0) {
      return Center(
        child: Text('暂无数据')
      );
    }
    // 返回SafeArea
    return Center(
        child: Text('返回SafeArea')
      );
  }
  ///动态TAB
  _loginContainer(BuildContext context){
    return Text('_loginContainer');
  }
}
```

运行 flutter run

最终结果：

<img src="./imgs/3.1Home主页基本框架.png">




### 2.完善 搜索栏

添加 lib\router.dart

```
import 'package:flutter/material.dart';
class Router {
  static const searchPage = 'app://SearchPage';
  Router.push(BuildContext context, String url,dynamic params) {
    print('router push');
  }
}
```

修改 lib/widgets/search_text_field_widget.dart

```
import 'package:flutter/material.dart';

class SearchTextFieldWidget extends StatelessWidget{
  final  ValueChanged<String> onSubmitted;
  final VoidCallback onTab;
  final String hintText;
  final EdgeInsetsGeometry margin;
  SearchTextFieldWidget({Key key, this.hintText,this.onSubmitted, this.onTab, this.margin}): super(key:key);

  @override
  Widget build(BuildContext context) {
    
    return Container(
      margin: margin == null ? EdgeInsets.all(0.0):margin,
      width: MediaQuery.of(context).size.width,
      alignment: AlignmentDirectional.center,
      height: 37.0,
      decoration: BoxDecoration(
        color: Color.fromARGB(255, 237, 236, 237),
        borderRadius: BorderRadius.circular(24.0),
      ),
      child: TextField(
        onSubmitted: onSubmitted,
        onTap: onTab,
        cursorColor: Color.fromARGB(255, 0, 189, 96),
        style: TextStyle(fontSize: 17),
        decoration: InputDecoration(
          contentPadding: const EdgeInsets.all(8.0),
          border: InputBorder.none,
          hintText: hintText,
          hintStyle: TextStyle(
            fontSize: 17, color: Color.fromARGB(255, 192, 191, 191)
          ),
          prefixIcon: Icon(
            Icons.search,
            size: 25,
            color: Color.fromARGB(255, 128, 128, 128),
          )
        ),
      ),
    );
  }
  
}
```

修改 lib\main.dart

```
 
// 省略...

SearchTextFieldWidget(
                      hintText: '影视作品中你难忘的离别',
                      margin: const EdgeInsets.only(left: 15.0, right: 15.0),
                      onTab: () {
                        Router.push(context, Router.searchPage, '影视作品中你难忘的离别');
                      },
                    ),

// 省略...

```

运行 flutter run

最后效果图：

<img src="./imgs/3.2Home主页AppBar.png">




完善 SliverContainer

添加 请求动态数据

添加 Subject 对象

添加 _loginContainer